{% load i18n %}
{% with current_level=level|default:0 %}
<ul class="tree-level level-{{ current_level }}">
    {% for node in nodes %}
        <li>
            <div class="node-card level-{{ current_level }}">
                <div class="node-header">
                    <span class="node-title">{{ node.sub_part.full_name }}</span>
                    <span class="node-quantity">Ã— {{ node.item.quantity|floatformat:-2 }}</span>
                </div>
                <div class="node-meta">
                    <span class="code">ID {{ node.sub_part.pk }}</span>
                    {% if node.sub_part.revision %}
                        <span class="code">{% blocktrans with revision=node.sub_part.revision %}Revisie {{ revision }}{% endblocktrans %}</span>
                    {% endif %}
                    {% if node.item.reference %}
                        <span class="code">{% trans "Referentie" %}: {{ node.item.reference }}</span>
                    {% endif %}
                    {% if node.sub_part.locked %}
                        <span class="badge locked">{% trans "Locked" %}</span>
                    {% else %}
                        <span class="badge unlocked">{% trans "Unlocked" %}</span>
                    {% endif %}
                    {% if node.item.optional %}
                        <span class="badge optional">{% trans "Optioneel" %}</span>
                    {% endif %}
                    {% if node.item.consumable %}
                        <span class="badge consumable">{% trans "Verbruik" %}</span>
                    {% endif %}
                    {% if node.cycle %}
                        <span class="badge cycle">{% trans "Cyclische referentie" %}</span>
                    {% endif %}
                </div>
                {% if node.sub_part.description %}
                    <p class="node-description">{{ node.sub_part.description }}</p>
                {% endif %}
                {% if node.item.note %}
                    <p class="node-notes">{{ node.item.note }}</p>
                {% endif %}
            </div>
            {% if node.children %}
                {% include "assembly_hierarchy/tree.html" with nodes=node.children level=current_level|add:'1' %}
            {% endif %}
        </li>
    {% endfor %}
</ul>
{% endwith %}
